<!DOCTYPE html>
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:p="http://primefaces.org/ui">
<f:metadata>
    <f:viewParam
        name="eventId"
        value="#{eventStat.id}" />
    <f:viewAction action="#{eventStat.init}" />
</f:metadata>
<h:head>
    <meta charset="UTF-8"></meta>
    <title>Statistics</title>
    <link
        href="css/common.css"
        rel="stylesheet"
        type="text/css"></link>
    <link
        href="css/commonColors.css"
        rel="stylesheet"
        type="text/css"></link>
    <link
        href="css/button.css"
        rel="stylesheet"
        type="text/css"></link>
    <link
        href="css/text.css"
        rel="stylesheet"
        type="text/css"></link>
    <link
        href="css/dataTable.css"
        rel="stylesheet"
        type="text/css"></link>
    <script
        type="text/javascript"
        src="js/cssLoader.js"></script>
    <script
        type="text/javascript"
        src="https://www.gstatic.com/charts/loader.js"></script>
    <script
        type="text/javascript"
        src="js/chartBuilder.js"></script>
    <script type="text/javascript">
      // Load the Visualization API and the corechart package.
      google.charts.load('current', {'packages':['corechart']});
    </script>
</h:head>
<body onload="drawChart('chart1', [['Présent', #{eventStat.eventStatData.nbIsPresent}], ['Absent', #{eventStat.eventStatData.nbIsNotPresent}], ['Sans réponse', #{eventStat.eventStatData.nbNotConfirmed}]]);
			  drawChart('chart2', [['Emails lus', #{eventStat.eventStatData.nbIsRead}], ['Emails non lus', #{eventStat.eventStatData.nbIsNotRead}]]);
			  drawChart('chart3', [['Présent', #{eventStat.eventStatData.nbIsPresentAfterReading}], ['Absent', #{eventStat.eventStatData.nbIsAbsentAfterReading}], ['Sans réponse', #{eventStat.eventStatData.nbIsNotConfirmedAfterReading}]]);">
    <script type="text/javascript">
		applyStyle();
	</script>
    <ui:include src="/includes/banner.xhtml" />
    <ui:include src="/includes/menu.xhtml">
        <ui:param
            name="eventId"
            value="#{eventStat.event.id}" />
        <ui:param
            name="webpagename"
            value="Statistiques de l'évènement" />
    </ui:include>
    <div class="wrapper">
        <h1>Statistiques de l'évènement</h1>
        <h2 class="center theme1">#{eventStat.event.title}</h2>
        <br />
        <br />
        <h:form>
            <p:dataTable
                id="subscribers"
                value="#{eventStat.subscribers}"
                var="subscriber"
                paginator="true"
                rows="5"
                paginatorAlwaysVisible="false">
                <f:facet name="header">
                	Membres invités
                </f:facet>
                <p:column class="email">
                    <f:facet name="header">
                    	email
                    </f:facet>
                    <div class="email">#{subscriber.email}</div>
                </p:column>
                <p:column styleClass="status">
                    <f:facet name="header">
                    	statut
                    </f:facet>
                    <div class="center">
                        <h:graphicImage
                            class="icon"
                            alt="#{subscriber.isPresentString}"
                            value="#{subscriber.iconPath}" />
                    </div>
                </p:column>
                <p:column class="center emaildate">
                    <f:facet name="header">
                    	date d'invitation
                    </f:facet>
                    <span>#{subscriber.sendingDateString}</span>
                </p:column>
                <f:facet name="footer">
                    <ui:fragment rendered="#{eventStat.size == 1}">
                    	Vous avez invité une personne à cet évènement.
                    </ui:fragment>
                    <ui:fragment rendered="#{eventStat.size == 0}">
                    	Vous n'avez encore invité personne à cet évènement.
                    </ui:fragment>
                    <ui:fragment rendered="#{eventStat.size >= 2}">
                    	Vous avez invité #{eventStat.size} personnes à cet évènement.
                    </ui:fragment>
                </f:facet>
            </p:dataTable>
        </h:form>
        <br />
        <br />
        <div class="frame center">
            <div id="chart1"></div>
            <span class="title">Réponse après invitation</span>            
        </div>
        <div class="frame center">
            <div id="chart2"></div>
            <span class="title">Statut d'email après invitation</span>            
        </div>
        <div class="frame center">
            <div id="chart3"></div>
            <span class="title">Réponse après ouverture d'email</span>            
        </div>
    </div>
</body>
</html>